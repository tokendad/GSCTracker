<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Apex Scout Manager</title>
    <link rel="stylesheet" href="styles.css?v=12">
</head>
<body>
    <div class="container">
        <header>
            <button id="mobileMenuBtn" class="mobile-menu-btn" title="Menu">
                <span class="hamburger-icon">‚ò∞</span>
            </button>
            <h1>Apex Scout Manager</h1>
            <button id="invitationsBtn" class="invitations-btn" title="Pending Invitations" onclick="openInvitationsModal()" style="display: none;">
                <span class="invite-icon">üì¨</span>
                <span id="invitationBadge" class="notification-badge">0</span>
            </button>
        </header>

        <div id="sidebarOverlay" class="sidebar-overlay"></div>

        <nav class="tab-nav">
            <button class="tab-btn active" data-view="profile">
                <span class="tab-icon">üë§</span>
                <span class="tab-label">Profile</span>
            </button>
            <button class="tab-btn" data-view="events">
                <span class="tab-icon">üìÖ</span>
                <span class="tab-label">Calendar</span>
            </button>
            <button class="tab-btn" data-view="settings">
                <span class="tab-icon">‚öôÔ∏è</span>
                <span class="tab-label">Settings</span>
            </button>
            <button class="tab-btn" data-view="troopLeader" id="troopLeaderTab" style="display: none;">
                <span class="tab-icon">üë•</span>
                <span class="tab-label">Troop</span>
            </button>
            <button class="tab-btn" data-view="council" id="councilTab" style="display: none;">
                <span class="tab-icon">üèõÔ∏è</span>
                <span class="tab-label">Council</span>
            </button>
            <div class="sidebar-divider"></div>
            <button id="logoutBtn" class="tab-btn logout-btn-sidebar">
                <span class="tab-icon">‚Ü™</span>
                <span class="tab-label">Logout</span>
            </button>
        </nav>

        <main>
            <!-- Profile View -->
                <!-- Add Sale Form -->
                <section class="add-sale-section">
                    
            <div id="view-profile" class="view-section">
                <section class="profile-display-section">
                    <div class="profile-card">
                        <div class="profile-photo-display">
                            <img id="profilePhotoDisplay" src="" alt="Profile Photo" class="profile-photo-large" style="display:none;">
                            <div id="profilePhotoPlaceholderDisplay" class="profile-photo-placeholder-large">üë§</div>
                        </div>

                        <!-- Scout Level Badge (Phase 3.1) -->
                        <div id="scoutLevelBadgeContainer" class="scout-level-badge-container" style="display:none;">
                            <div id="scoutLevelBadge" class="scout-level-badge">
                                <div class="badge-content">
                                    <span id="scoutLevelName" class="badge-level-name"></span>
                                    <span id="scoutOrgName" class="badge-org-name"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="qr-codes-display">
                        <div class="qr-card">
                            <h3>My Cookie Store</h3>
                            <div id="storeQrDisplay" class="qr-display-container">
                                <img id="storeQrImageDisplay" src="" alt="Store QR Code" style="display:none;">
                                <p id="storeQrPlaceholder" class="qr-placeholder">No store QR code set.<br>Add one in Settings.</p>
                            </div>
                        </div>

                        <div class="qr-card">
                            <h3>Payment Methods</h3>
                            <div id="paymentMethodsDisplay" class="qr-methods-container">
                                <p id="paymentMethodsPlaceholder" class="qr-placeholder">No payment methods set.<br>Add them in Settings.</p>
                                <!-- Payment methods will be injected here -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- On-Hand Inventory Section -->
                <section class="inventory-section">
                    <h2>On-Hand Inventory</h2>
                    <p class="inventory-subtitle">Track the boxes you currently have</p>
                    <div class="inventory-grid">
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Thin Mints¬Æ</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('ThinMints')">‚àí</button>
                                <input type="number" id="inventoryThinMints" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('ThinMints')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Samoas¬Æ</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Samoas')">‚àí</button>
                                <input type="number" id="inventorySamoas" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Samoas')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Tagalongs¬Æ</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Tagalongs')">‚àí</button>
                                <input type="number" id="inventoryTagalongs" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Tagalongs')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Trefoils¬Æ</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Trefoils')">‚àí</button>
                                <input type="number" id="inventoryTrefoils" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Trefoils')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Do-si-dos¬Æ</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('DosiDos')">‚àí</button>
                                <input type="number" id="inventoryDosiDos" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('DosiDos')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Lemon-Ups¬Æ</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('LemonUps')">‚àí</button>
                                <input type="number" id="inventoryLemonUps" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('LemonUps')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Adventurefuls¬Æ</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Adventurefuls')">‚àí</button>
                                <input type="number" id="inventoryAdventurefuls" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Adventurefuls')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Exploremores‚Ñ¢</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Exploremores')">‚àí</button>
                                <input type="number" id="inventoryExploremores" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Exploremores')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Toffee-tastic¬Æ</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Toffeetastic')">‚àí</button>
                                <input type="number" id="inventoryToffeetastic" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Toffeetastic')">+</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Cookie Details Section -->
                <section class="cookie-details-section">
                    <h2>Meet the Cookies</h2>
                    <p class="cookie-price-note">All cookies are $6 per box</p>
                    <div class="cookie-grid">
                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1574458209.coreimg.png/1757342350486/meetthecookies-graphics-hybridthinmints-255x255.png" alt="Thin Mints">
                            <h3>Thin Mints¬Æ</h3>
                            <span class="cookie-badge vegan">Vegan</span>
                            <p class="cookie-description">Crisp, chocolate cookies dipped in a delicious mint chocolaty coating.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1168943426.coreimg.png/1736976066246/meetthecookies-graphics-hybridsamoascarameldelites-255x255.png" alt="Samoas">
                            <h3>Samoas¬Æ</h3>
                            <p class="cookie-alt-name">(Caramel deLites¬Æ)</p>
                            <p class="cookie-description">Crisp cookies with caramel, coconut, and chocolaty stripes.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_435681049.coreimg.png/1693315815634/meetthecookies-graphics-hybridpeanutbutterpattiestagalongs-255x255.png" alt="Tagalongs">
                            <h3>Tagalongs¬Æ</h3>
                            <p class="cookie-alt-name">(Peanut Butter Patties¬Æ)</p>
                            <span class="cookie-badge vegan">Vegan</span>
                            <p class="cookie-description">Crispy cookies layered with peanut butter and covered with a chocolaty coating.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_750886972.coreimg.png/1757342220634/meetthecookies-graphics-hybridshortbreadtrefoils-255x255.png" alt="Trefoils">
                            <h3>Trefoils¬Æ</h3>
                            <p class="cookie-description">Iconic shortbread cookies inspired by the original recipe.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1034315555.coreimg.png/1736976132377/meetthecookies-graphics-hybridpeanutbuttersandwichdosidos-255x255.png" alt="Do-si-dos">
                            <h3>Do-si-dos¬Æ</h3>
                            <p class="cookie-alt-name">(Peanut Butter Sandwich)</p>
                            <p class="cookie-description">Crunchy oatmeal sandwich cookies with peanut butter filling.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1787644668.coreimg.png/1757342264367/meetthecookies-graphics-lbblemonups-255x255.png" alt="Lemon-Ups">
                            <h3>Lemon-Ups¬Æ</h3>
                            <p class="cookie-description">Crispy lemon cookies baked with inspiring messages.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage.coreimg.png/1757342369090/meetthecookies-graphics-hybridadventurefuls-255x255.png" alt="Adventurefuls">
                            <h3>Adventurefuls¬Æ</h3>
                            <p class="cookie-description">Indulgent brownie-inspired cookies topped with caramel flavored cr√®me with a hint of sea salt.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1402666257.coreimg.png/1757509269312/meetthecookies-exploremores-hybrid-255x255.png" alt="Exploremores">
                            <h3>Exploremores‚Ñ¢</h3>
                            <p class="cookie-description">Sandwich cookies with chocolate, marshmallow, and almond flavored creme.</p>
                        </div>

                        <div class="cookie-detail-card cookie-gf">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1157222513.coreimg.png/1757342209646/meetthecookies-graphics-lbbtoffeetastic-255x255.png" alt="Toffee-tastic">
                            <h3>Toffee-tastic¬Æ</h3>
                            <span class="cookie-badge gluten-free">Gluten-Free</span>
                            <p class="cookie-description">Rich, buttery cookies with sweet, crunchy toffee bits.</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Dashboard View -->
            <!-- Events View -->
            <div id="view-events" class="view-section hidden">
                <div class="calendar-controls-header">
                    <h2>Calendar</h2>
                    <div class="calendar-actions">
                        <button class="btn btn-secondary" onclick="exportCalendar()">Export .ics</button>
                        <button class="btn btn-primary" onclick="toggleAddEventForm()">+ Add Event</button>
                    </div>
                </div>

                <!-- Add Event Form (Hidden by default) -->
                <section id="addEventSection" class="add-event-section hidden">
                    <h3>Record Event</h3>
                    <form id="eventForm">
                        <div class="form-section">
                            <div class="form-group">
                                <label for="eventName">Event Name *</label>
                                <input type="text" id="eventName" placeholder="e.g., Pack Meeting" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="eventDate">Date *</label>
                                    <input type="date" id="eventDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="eventType">Type</label>
                                    <select id="eventType">
                                        <option value="event">General</option>
                                        <option value="meeting">Meeting</option>
                                        <option value="booth">Booth</option>
                                        <option value="outing">Outing</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="eventStartTime">Start Time</label>
                                    <input type="time" id="eventStartTime">
                                </div>
                                <div class="form-group">
                                    <label for="eventEndTime">End Time</label>
                                    <input type="time" id="eventEndTime">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="eventLocation">Location</label>
                                    <input type="text" id="eventLocation" placeholder="Location">
                                </div>
                                <div class="form-group">
                                    <label for="targetGroup">Group</label>
                                    <select id="targetGroup">
                                        <option value="Troop">Whole Troop/Pack</option>
                                        <option value="Lion">Lion</option>
                                        <option value="Tiger">Tiger</option>
                                        <option value="Wolf">Wolf</option>
                                        <option value="Bear">Bear</option>
                                        <option value="Webelos">Webelos</option>
                                        <option value="AOL">AOL</option>
                                        <option value="Daisy">Daisy</option>
                                        <option value="Brownie">Brownie</option>
                                        <option value="Junior">Junior</option>
                                        <option value="Cadette">Cadette</option>
                                        <option value="Senior">Senior</option>
                                        <option value="Ambassador">Ambassador</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="eventDescription">Description</label>
                                <input type="text" id="eventDescription" placeholder="Optional description">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-large">Save Event</button>
                    </form>
                </section>

                <!-- Filters -->
                <div class="calendar-filter-bar">
                    <span class="filter-label">Show:</span>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Troop" checked> Pack/Troop</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Lion" checked> Lion</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Tiger" checked> Tiger</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Wolf" checked> Wolf</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Bear" checked> Bear</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Webelos" checked> Webelos</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="AOL" checked> AOL</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Daisy" checked> Daisy</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Brownie" checked> Brownie</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Junior" checked> Junior</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Cadette" checked> Cadette</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Senior" checked> Senior</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Ambassador" checked> Ambassador</label>
                </div>

                <!-- Calendar -->
                <section class="calendar-section">
                    <div class="calendar-header">
                        <div class="calendar-nav-group">
                            <button class="calendar-nav-btn" onclick="changeMonth(-1)">&lt;</button>
                            <h3 id="calendarMonthYear">Month Year</h3>
                            <button class="calendar-nav-btn" onclick="changeMonth(1)">&gt;</button>
                        </div>
                        <button class="calendar-today-btn" onclick="goToToday()">Today</button>
                    </div>
                    <div class="calendar-weekdays">
                        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                    </div>
                    <div id="calendarGrid" class="calendar-grid">
                        <!-- Days generated by JS -->
                    </div>
                </section>
            </div>

            <!-- Settings View -->
            <div id="view-settings" class="view-section hidden">
                <section class="settings-section">
                    <h2>Settings</h2>

                    <!-- Payment Methods -->
                    <div class="settings-group">
                        <h3>Payment Methods</h3>
                        <p class="settings-description">Add your digital payment links so customers can pay online.</p>
                        <div id="settingsPaymentMethodsList" class="payment-methods-list">
                            <p class="empty-message">No payment methods added yet.</p>
                        </div>
                        <div class="add-payment-method">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newPaymentName">Method Name</label>
                                    <input type="text" id="newPaymentName" placeholder="e.g., Venmo">
                                </div>
                                <div class="form-group">
                                    <label for="newPaymentUrl">Payment URL</label>
                                    <input type="url" id="newPaymentUrl" placeholder="e.g., https://venmo.com/yourname">
                                </div>
                            </div>
                            <button id="addPaymentMethodBtn" class="btn btn-secondary">Add Payment Method</button>
                        </div>
                    </div>

                </section>
            </div>

            <!-- Council View -->
            <div id="view-council" class="view-section hidden">
                <section class="council-section">
                    <h2>Council Administration</h2>
                    <p class="section-description">Manage troops across your council. More features coming in a future phase.</p>

                    <div class="council-actions">
                        <div class="council-card">
                            <h3>Troop Management</h3>
                            <p>Create and manage troops within your council.</p>
                            <button id="createTroopBtn" class="btn btn-primary">+ New Troop</button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Troop Leader View -->
            <div id="view-troopLeader" class="view-section hidden">
                <section class="troop-section">
                    <div class="troop-header">
                        <h2>Troop Selection</h2>
                        <div class="troop-controls">
                            <select id="troopSelector" class="troop-select">
                                <option value="">Select a troop...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Troop Top Navigation -->
                    <div class="troop-top-nav" role="tablist">
                        <button class="troop-tab active" data-tab="membership">Membership</button>
                        <button class="troop-tab" data-tab="dashboard">Cookies</button>
                        <button class="troop-tab" data-tab="financials">Financials</button>
                        <button class="troop-tab" data-tab="equipment">Equipment</button>
                        <button class="troop-tab" data-tab="events">Events</button>
                        <button class="troop-tab" data-tab="media">Media</button>
                        <button class="troop-tab" data-tab="library">Library</button>
                        <button class="troop-tab" data-tab="permissions">Permissions</button>
                    </div>

                    <div id="troop-content" class="troop-content">
                        <!-- Membership Tab -->
                        <div id="troop-tab-membership" class="troop-tab-panel">
                            <h2>Membership</h2>
                            <div class="membership-actions">
                                <button id="addMemberBtnMembership" class="btn btn-primary add-member-btn" onclick="openAddMemberModal()">Add Member</button>
                                <input id="memberSearch" type="search" placeholder="Search members..." />
                            </div>

                            <!-- Membership Sub-Tab Navigation -->
                            <div class="membership-subnav" role="tablist">
                                <button class="membership-subtab active" data-sub="scout">Scout</button>
                                <button class="membership-subtab" data-sub="family">Family</button>
                                <button class="membership-subtab" data-sub="leadership">Leadership</button>
                                <button class="membership-subtab" data-sub="volunteer">Volunteer</button>
                            </div>

                            <!-- Membership Sub-Panels -->
                            <div class="membership-subpanels">
                                <div id="membership-sub-scout" class="membership-subpanel">
                                    <table class="membership-table">
                                        <thead>
                                            <tr><th>Name</th><th>Role</th><th>Level</th><th>Status</th><th>Actions</th></tr>
                                        </thead>
                                        <tbody id="membershipTableBody_scout">
                                            <tr><td colspan="5" class="empty-state">Select a troop to view members</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div id="membership-sub-family" class="membership-subpanel hidden">
                                    <table class="membership-table">
                                        <thead>
                                            <tr><th>Last Name</th></tr>
                                        </thead>
                                        <tbody id="membershipTableBody_family">
                                            <tr><td class="empty-state">Select a troop to view families</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div id="membership-sub-leadership" class="membership-subpanel hidden">
                                    <table class="membership-table">
                                        <thead>
                                            <tr><th>Name</th><th>Role</th><th>Level</th><th>Status</th><th>Actions</th></tr>
                                        </thead>
                                        <tbody id="membershipTableBody_leadership">
                                            <tr><td colspan="5" class="empty-state">No leadership members</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div id="membership-sub-volunteer" class="membership-subpanel hidden">
                                    <table class="membership-table">
                                        <thead>
                                            <tr><th>Name</th><th>Role</th><th>Level</th><th>Status</th><th>Actions</th></tr>
                                        </thead>
                                        <tbody id="membershipTableBody_volunteer">
                                            <tr><td colspan="5" class="empty-state">No volunteers</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Dashboard Tab -->
                        <div id="troop-tab-dashboard" class="troop-tab-panel hidden">
                        <div class="summary-cards">
                            <div class="summary-card">
                                <span class="summary-icon">üì¶</span>
                                <div class="summary-data">
                                    <span class="summary-value" id="troopTotalBoxes">0</span>
                                    <span class="summary-label">Total Boxes</span>
                                </div>
                            </div>
                            <div class="summary-card">
                                <span class="summary-icon">üíµ</span>
                                <div class="summary-data">
                                    <span class="summary-value" id="troopTotalCollected">$0</span>
                                    <span class="summary-label">Collected</span>
                                </div>
                            </div>
                            <div class="summary-card">
                                <span class="summary-icon">üë•</span>
                                <div class="summary-data">
                                    <span class="summary-value" id="troopMemberCount">0</span>
                                    <span class="summary-label">Members</span>
                                </div>
                            </div>
                        </div>

                        <!-- Leaderboard and Goals Row -->
                        <div class="troop-dashboard-row">
                            <!-- Leaderboard -->
                            <div class="troop-leaderboard-section">
                                <div class="section-header">
                                    <h3>Top Sellers</h3>
                                    <select id="leaderboardMetric" class="metric-select" onchange="loadLeaderboard()">
                                        <option value="boxes">By Boxes</option>
                                        <option value="revenue">By Revenue</option>
                                    </select>
                                </div>
                                <div id="leaderboardList" class="leaderboard-list">
                                    <p class="empty-state">No sales data yet</p>
                                </div>
                            </div>

                            <!-- Troop Goals Progress -->
                            <div class="troop-goals-section">
                                <div class="section-header">
                                    <h3>Troop Goals</h3>
                                    <button id="addGoalBtn" class="btn btn-secondary btn-sm">+ Add Goal</button>
                                </div>
                                <div id="troopGoalsList" class="goals-list">
                                    <p class="empty-state">No goals set. Add a goal to track progress!</p>
                                </div>
                            </div>
                        </div>

                        <!-- Member Performance Table -->
                        <div class="troop-members-section">
                            <div class="section-header">
                                <h3>Member Performance</h3>
                                <button id="addMemberBtn" class="btn btn-secondary btn-sm add-member-btn" onclick="openAddMemberModal()">+ Add Member</button>
                            </div>
                            <div class="members-table-container">
                                <table class="members-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Role</th>
                                            <th>Boxes Sold</th>
                                            <th>Collected</th>
                                            <th>Last Sale</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="troopMembersTable">
                                        <tr><td colspan="6" class="empty-state">No members yet</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Sales by Cookie Type -->
                        <div class="troop-sales-section">
                            <h3>Sales by Cookie Type</h3>
                            <div id="troopSalesByCookie" class="cookie-sales-grid">
                                <p class="empty-state">No sales data yet</p>
                            </div>
                        </div>
                        </div><!-- end troop-tab-dashboard -->

                        <!-- Financials placeholder -->
                        <div id="troop-tab-financials" class="troop-tab-panel hidden">
                            <h2>Financials</h2>
                            <p>Financial summary and transactions will appear here (placeholder).</p>
                        </div>

                        <!-- Equipment placeholder -->
                        <div id="troop-tab-equipment" class="troop-tab-panel hidden">
                            <h2>Equipment</h2>
                            <p>Equipment inventory and loan tracking (placeholder).</p>
                        </div>

                        <!-- Events placeholder -->
                        <div id="troop-tab-events" class="troop-tab-panel hidden">
                            <h2>Events</h2>
                            <p>Troop events and booth schedule (placeholder).</p>
                        </div>

                        <!-- Media placeholder -->
                        <div id="troop-tab-media" class="troop-tab-panel hidden">
                            <h2>Media</h2>
                            <p>Photos and uploaded files (placeholder).</p>
                        </div>

                        <!-- Library placeholder -->
                        <div id="troop-tab-library" class="troop-tab-panel hidden">
                            <h2>Library</h2>
                            <p>Document library and resources (placeholder).</p>
                        </div>

                        <!-- Permissions Tab -->
                        <div id="troop-tab-permissions" class="troop-tab-panel hidden">
                            <h2>Member Permissions</h2>
                            <p class="permissions-description">
                                Adjust what each member can do within this troop. Changes override the role defaults.<br>
                                <strong>T</strong> = Troop &nbsp; <strong>D</strong> = Den/Patrol &nbsp;
                                <strong>H</strong> = Household &nbsp; <strong>S</strong> = Self &nbsp;
                                <strong>---</strong> = None
                            </p>

                            <div class="permissions-controls">
                                <div class="form-group">
                                    <label for="permsMemberSelect">Select Member</label>
                                    <select id="permsMemberSelect">
                                        <option value="">Choose a member...</option>
                                    </select>
                                </div>
                            </div>

                            <div id="permsMatrixContainer" style="display: none;">
                                <div class="permissions-member-info" id="permsMemberInfo"></div>
                                <div class="permissions-matrix-wrapper">
                                    <table class="permissions-matrix" id="permsMatrix">
                                        <thead>
                                            <tr>
                                                <th class="priv-name-col">Privilege</th>
                                                <th class="priv-scope-col">T</th>
                                                <th class="priv-scope-col">D</th>
                                                <th class="priv-scope-col">H</th>
                                                <th class="priv-scope-col">S</th>
                                                <th class="priv-scope-col">---</th>
                                                <th class="priv-default-col">Default</th>
                                            </tr>
                                        </thead>
                                        <tbody id="permsMatrixBody"></tbody>
                                    </table>
                                </div>
                                <div class="permissions-actions">
                                    <button class="btn btn-secondary" id="resetPermsBtn">Reset All to Defaults</button>
                                    <button class="btn btn-primary" id="savePermsBtn">Save Changes</button>
                                </div>
                            </div>

                            <div id="permsEmptyState" class="empty-state">
                                <p>Select a member above to view and manage their permissions.</p>
                            </div>
                        </div>
                    </div><!-- end troop-content -->

                    <!-- Empty State (no troop selected) -->
                    <div id="troopEmptyState" class="troop-empty-state">
                        <div class="empty-state-content">
                            <span class="empty-icon">üë•</span>
                            <h3>Welcome, Troop Leader!</h3>
                            <p>Select a troop from the dropdown above or create a new one to get started.</p>
                        </div>
                    </div>
                </section>

                <!-- Create Troop Modal -->
                <div id="createTroopModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Create New Troop</h3>
                            <button class="modal-close" onclick="closeCreateTroopModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="newTroopNumber">Troop Number *</label>
                                <input type="text" id="newTroopNumber" placeholder="e.g., 12345" required>
                            </div>
                            <div class="form-group">
                                <label for="newTroopType">Troop Type *</label>
                                <select id="newTroopType" required>
                                    <option value="">Select type...</option>
                                    <option value="daisy">Daisy (K-1)</option>
                                    <option value="brownie">Brownie (2-3)</option>
                                    <option value="junior">Junior (4-5)</option>
                                    <option value="cadette">Cadette (6-8)</option>
                                    <option value="senior">Senior (9-10)</option>
                                    <option value="ambassador">Ambassador (11-12)</option>
                                    <option value="multi-level">Multi-Level</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="newTroopMeetingLocation">Meeting Location</label>
                                <input type="text" id="newTroopMeetingLocation" placeholder="e.g., Community Center">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newTroopMeetingDay">Meeting Day</label>
                                    <select id="newTroopMeetingDay">
                                        <option value="">Select day...</option>
                                        <option value="Monday">Monday</option>
                                        <option value="Tuesday">Tuesday</option>
                                        <option value="Wednesday">Wednesday</option>
                                        <option value="Thursday">Thursday</option>
                                        <option value="Friday">Friday</option>
                                        <option value="Saturday">Saturday</option>
                                        <option value="Sunday">Sunday</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="newTroopMeetingTime">Meeting Time</label>
                                    <input type="time" id="newTroopMeetingTime">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeCreateTroopModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="createTroop()">Create Troop</button>
                        </div>
                    </div>
                </div>

                <!-- Add Member Modal -->
                <div id="addMemberModal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-height: 90vh; overflow-y: auto;">
                        <div class="modal-header">
                            <h3>Add Member</h3>
                            <button class="modal-close" onclick="closeAddMemberModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="addMemberForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="memberFirstName">First Name *</label>
                                        <input type="text" id="memberFirstName" placeholder="First name">
                                    </div>
                                    <div class="form-group">
                                        <label for="memberLastName">Last Name *</label>
                                        <input type="text" id="memberLastName" placeholder="Last name">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="memberEmail">Email</label>
                                    <input type="email" id="memberEmail" placeholder="email@example.com">
                                </div>

                                <div class="form-group">
                                    <label for="memberAddress">Address</label>
                                    <input type="text" id="memberAddress" placeholder="Street address, city, state">
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="memberBirthdate">Birthdate</label>
                                        <input type="date" id="memberBirthdate">
                                    </div>
                                    <div class="form-group">
                                        <label for="memberDen">Den</label>
                                        <input type="text" id="memberDen" placeholder="Den name/number">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="memberFamilyInfo">Family Info</label>
                                    <textarea id="memberFamilyInfo" rows="2" placeholder="Optional family notes or contact info"></textarea>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="memberLevel">Position</label>
                                        <select id="memberLevel" onchange="onPositionChange()">
                                            <option value="">Select position...</option>
                                            <option value="Scout">Scout</option>
                                            <option value="Troop Leader">Troop Leader</option>
                                            <option value="Co-Leader">Co-Leader</option>
                                            <option value="Troop Volunteer">Troop Volunteer</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="rolesGroup">
                                        <label for="memberRoles" id="rolesLabel">Roles</label>
                                        <select id="memberRoles" multiple size="6">
                                            <!-- Options populated dynamically based on position -->
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddMemberModal()">Cancel</button>
                            <button class="btn btn-primary" id="confirmAddMemberBtn" onclick="submitAddMember()">Save</button>
                        </div>
                    </div>
                </div>

                <!-- Add Goal Modal -->
                <div id="addGoalModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add Troop Goal</h3>
                            <button class="modal-close" onclick="closeAddGoalModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="goalType">Goal Type *</label>
                                <select id="goalType" required>
                                    <option value="">Select type...</option>
                                    <option value="boxes_sold">Boxes Sold</option>
                                    <option value="revenue">Revenue ($)</option>
                                    <option value="participation">Participation (%)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="goalTarget">Target Amount *</label>
                                <input type="number" id="goalTarget" min="1" placeholder="e.g., 500">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="goalStartDate">Start Date</label>
                                    <input type="date" id="goalStartDate">
                                </div>
                                <div class="form-group">
                                    <label for="goalEndDate">End Date</label>
                                    <input type="date" id="goalEndDate">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="goalDescription">Description</label>
                                <textarea id="goalDescription" rows="2" placeholder="Optional description..."></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddGoalModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="createGoal()">Create Goal</button>
                        </div>
                    </div>
                </div>

                <!-- Nutrition Info Modal -->
                <div id="nutritionModal" class="modal" style="display: none;">
                    <div class="modal-content nutrition-modal">
                        <div class="modal-header">
                            <h3 id="nutritionCookieName">Cookie Name</h3>
                            <button class="modal-close" onclick="closeNutritionModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="nutrition-facts">
                                <h4>Nutrition Facts</h4>
                                <p class="serving-size" id="nutritionServing">Serving Size: --</p>
                                <div class="nutrition-divider thick"></div>
                                <table class="nutrition-table">
                                    <tbody id="nutritionTableBody">
                                        <!-- Nutrition data injected here -->
                                    </tbody>
                                </table>
                                <div class="nutrition-divider"></div>
                                <div id="nutritionIngredients" class="ingredients">
                                    <strong>Ingredients:</strong> <span id="ingredientsList">--</span>
                                </div>
                            </div>
                            <div id="nutritionAttributes" class="nutrition-attributes">
                                <!-- Attribute badges injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invitations Modal -->
                <div id="invitationsModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Troop Invitations</h3>
                            <button class="modal-close" onclick="closeInvitationsModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div id="invitationsList" class="invitations-list">
                                <p class="empty-state">No pending invitations</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Send Invitation Modal -->
                <div id="sendInviteModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Invite Member to Troop</h3>
                            <button class="modal-close" onclick="closeSendInviteModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="inviteEmail">Email Address *</label>
                                <input type="email" id="inviteEmail" placeholder="Enter email address">
                            </div>
                            <div class="form-group">
                                <label for="inviteRole">Role in Troop</label>
                                <select id="inviteRole">
                                    <option value="scout">Scout</option>
                                    <option value="parent">Parent</option>
                                    <option value="co-leader">Co-Leader</option>
                                    <option value="assistant">Assistant</option>
                                    <option value="cookie_leader">Cookie Leader</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeSendInviteModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="sendInvitation()">Send Invitation</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>&copy; 2026 Apex Scout Manager</p>
        </footer>
    </div>

    <script src="script.js?v=12"></script>
</body>
</html>
